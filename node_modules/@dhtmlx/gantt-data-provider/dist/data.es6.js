class t{constructor(t,e){this._url=t,this._queue={},this._updates=e,this._ids=new Map}getData(){const t=fetch(this._url+"/tasks").then((t=>t.json())),e=fetch(this._url+"/links").then((t=>t.json()));return Promise.all([t,e]).then((([t,e])=>({tasks:t,links:e})))}serializeTask(t){return{progress:t.progress||0,parent:t.parent?this._ids.get("t"+t.parent)||t.parent:0,text:t.text||"",details:t.details||"",duration:t.duration||1,start_date:this.dateFormat(t.start_date),end_date:this.dateFormat(t.end_date)}}serializeMove(t){return{mode:t.mode,target:t.target?this._ids.get("t"+t.target)||t.target:0,parent:t.parent?this._ids.get("t"+t.parent)||t.parent:0}}serializeLink(t){return{source:this._ids.get("t"+t.source)||t.source,target:this._ids.get("t"+t.target)||t.target,type:t.type}}dateFormat(t){return"string"==typeof t?t:t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" 00:00"}saveData(t){const{action:e,obj:s}=t;let i=s.id.toString();const a=e[e.lastIndexOf("-")+1];switch(i=this._ids.get(a+i)||i,e){case"update-task":{const t=this._queue[i];t&&clearTimeout(t),this._queue[i]=setTimeout((()=>this.send("/tasks/"+i,"PUT",this.serializeTask(s))),1e3);break}case"reorder-task":this.send(`/tasks/${i}/position`,"PUT",this.serializeMove(s));break;case"add-task":this.send("/tasks","POST",Object.assign({mode:t.mode},this.serializeTask(s))).then((t=>{t.id&&this._ids.set("t"+i,t.id.toString()),this._updates&&this._updates.task&&this._updates.task(i,t)}));break;case"delete-task":this.send("/tasks/"+i,"DELETE");break;case"update-link":this.send("/links/"+i,"PUT",this.serializeLink(s));break;case"add-link":this.send("/links","POST",this.serializeLink(s)).then((t=>{t.id&&this._ids.set("l"+i,t.id.toString()),this._updates&&this._updates.link&&this._updates.link(i,t)}));break;case"delete-link":this.send("/links/"+i,"DELETE")}}send(t,e,s){const i={method:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}};if(s){const t=[];for(const e in s)t.push(`${e}=${encodeURIComponent(s[e])}`);i.body=t.join("&")}return fetch(this._url+t,i).then((t=>t.json()))}}export{t as RestDataProvider};
//# sourceMappingURL=data.es6.js.map
